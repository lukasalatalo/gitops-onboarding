apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - litellm/postgres-secret.yaml
  - litellm/postgres-deployment.yaml
  - litellm/postgres-service.yaml
  - litellm/deployment.yaml
  - litellm/service.yaml
  - openwebui/deployment.yaml
  - openwebui/service.yaml

configMapGenerator:
  - name: litellm-config
    files:
      - config.yaml=litellm/config-content.yaml

# Update the deployment to reference the generated ConfigMap name (with hash)
# This ensures the deployment restarts when the ConfigMap changes
replacements:
  - source:
      kind: ConfigMap
      name: litellm-config
      fieldPath: metadata.name
    targets:
      - select:
          kind: Deployment
          name: litellm
        fieldPaths:
          - spec.template.spec.volumes.0.configMap.name

