apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-clickhouse-config
data:
  custom-config.xml: |
    <?xml version="1.0"?>
    <clickhouse>
        <!-- Define a default cluster pointing to itself for standalone mode -->
        <!-- This allows Langfuse to use ON CLUSTER syntax without Zookeeper -->
        <remote_servers>
            <default>
                <shard>
                    <replica>
                        <host>localhost</host>
                        <port>9000</port>
                    </replica>
                </shard>
            </default>
        </remote_servers>
        
        <!-- Macros for ReplicatedMergeTree to work without Zookeeper -->
        <!-- These macros allow ReplicatedMergeTree to work in standalone mode -->
        <macros>
            <shard>1</shard>
            <replica>1</replica>
        </macros>
        
        <!-- Configure Zookeeper for ReplicatedMergeTree -->
        <!-- Zookeeper is required for ReplicatedMergeTree engine -->
        <zookeeper>
            <node>
                <host>langfuse-zookeeper</host>
                <port>2181</port>
            </node>
        </zookeeper>
        
        <!-- Alternative: Use MergeTree settings -->
        <merge_tree>
            <allow_remote_fs_zero_copy_replication>0</allow_remote_fs_zero_copy_replication>
        </merge_tree>
    </clickhouse>

